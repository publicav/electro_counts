$(function(){var d=$("#right");var b={render:{},data:"",url:"",type:"",init:function(i,g,j,h){if(j===void 0){j=""}if(h===void 0){h="post"}this.data=j;this.render=i;this.url=g;this.type=h},reqest:function(){var h=this;var g=this;$.ajax({dataType:"json",type:g.type,url:g.url,data:g.data}).done(function(i){console.log(i);h.render.doRun(i.data);h.render.render()}).fail(function(i){return alert(i.responseJSON.error)})}};var c={dest:{},html:"",init:function(g){this.dest=g},doRun:function(k){var h='<div id="group-counter">';h+='<ul class="ui-group-counter">';for(var j=0;j<k.length;j++){var g=k[j];h+='<li id="g-'+g.id+'" class="group-counter-list">'+g.name+"</li>"}h+="</ul>";h+="</div>";this.html=h},render:function(){this.dest.find("#group-counter").remove();this.dest.append(this.html);$("ul.ui-group-counter").sortable({connectWith:"ul"})}};var f=$("#group-counter-name-form").dialog({title:"Добавление группы",autoOpen:false,resizable:false,modal:true,height:170,width:600,close:function(){var g=$(this)[0];g.reset()},buttons:[{text:"Ok",click:function(){a.doGroupName(this);c.init(d);b.init(c,"ajax/getgroup_all/","","get");b.reqest();$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});var a={doGroupName:function(h){var i=$(h).attr("method");var g=$(h).attr("action");var j=$(h).serialize();$.ajax({dataType:"json",type:i,url:g,data:j}).done(function(){}).fail(function(k){return alert(k.responseJSON.error)})}};var e={sorting:"",init:function(g){var h="";g.each(function(i,j){if(i!=0){h+=","}h+=$(j).attr("id").substring(2)});this.sorting=h},doSorting:function(){$.ajax({dataType:"json",type:"post",url:"ajax/actionbtn_sorting_group/",data:{sort:this.sorting}}).done(function(){}).fail(function(g){return alert(g.responseJSON.error)})}};$(d).append('<div id="btn-action-group" class="widget">\n            <button id="add-group"><i class="fa fa-plus"></i>\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443</button>\n            <button id="sorting-group"><i class="fa fa-save"></i></i>\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0443</button>\n            \n        </div>');c.init(d);b.init(c,"ajax/getgroup_all/","","get");b.reqest();$("#add-group").click(function(g){console.log("Add group");f.dialog("open");g.preventDefault()});$("#sorting-group").click(function(g){console.log("Sorting group");e.init($("#group-counter").find("li"));e.doSorting();g.preventDefault()});$(".widget button").button()});