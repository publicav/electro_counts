$(function(){var j=$("#right");var e={objUser:$("#user_edit"),objPassword:$("#pass_edit"),objConfirmPassword:$("#pass_repeat_edit"),objUserFamily:$("#family_edit"),objUserName:$("#name_edit"),objId:$("#edit_user_id")};var h={render:{},data:"",url:"",type:"",init:function(n,l,o,m){if(o===void 0){o={}}if(m===void 0){m="post"}this.data=o;this.render=n;this.url=l;this.type=m},reqest:function(){var m=this;var l=this;$.ajax({dataType:"json",type:l.type,url:l.url,data:l.data}).done(function(n){console.log(n);m.render.doRun(n.data);m.render.render()}).fail(function(n){return alert(n.responseJSON.error)})}};var f={dest:{},html:"",init:function(l){this.dest=l},doRun:function(p){var o=0,n,l;l=this.doUserBtnAdd();l+='<div class="title_table_user">\n                        <div class="title_user">\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C</div>\n                        <div class="title_family">\u0424\u0430\u043C\u0438\u043B\u0438\u044F</div>\n                        <div class="title_name">\u0418\u043C\u044F</div>\n                   </div>';for(var m in p){if(o%2!=0){n="counter_str_odd"}else{n="counter_str_even"}l+='\n                <div id="id_'+p[m].id+'" class="'+n+'"  title="\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F">\n                    <div class="col_user">'+p[m].users+'</div>\n                    <div class="col_family">'+p[m].family+'</div>\n                    <div class="col_name">'+p[m].name+"</div>\n               </div>";o++}this.html=l},doUserBtnAdd:function(){return'\n            \t<div id="add_user_btn">\n                    <div class="btn-ico"><img src="img/web/add_user.png" width="32" height="32" alt="add_user"></div>\n                    <div class="btn-text">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F</div>\n                </div>'},render:function(){this.dest.html(this.html)}};var c={dest:{},init:function(l){this.dest=l},doRun:function(l){this.dest.objUser.val(l.users);this.dest.objPassword.val("");this.dest.objConfirmPassword.val("");this.dest.objUserFamily.val(l.family);this.dest.objUserName.val(l.name);this.dest.objId.val(l.id)},render:function(){}};var b={dest:{},html:"",init:function(l){this.dest=l},doRun:function(n){console.log(n);var l="<ol>";for(var m=0;m<n.length;m++){l+="<li>"+n[m].name+'\n\t\t\t\t\t\t\t\t    <input id="check_'+n[m].id_a+'" class="privilege_checkbox" type="checkbox" '+n[m].checked+"/>\n\t\t\t\t\t\t\t    </li>"}l+="</ol>";this.html=l},render:function(){this.dest.html(this.html)}};var k=function(m){var p=$(m);var n=p.attr("method");var l=p.attr("action");var o=p.serialize();$.ajax({dataType:"json",type:n,url:l,data:o}).done(function(q){if(q.success==true){}else{alert(q.error)}}).fail(function(q){return alert(q.responseJSON.error)})};var g=function(n){var r=$(n);var l="";var o=r.attr("method");var m=r.attr("action");var q=r.find("input[type=checkbox]");$(q).each(function(){var s=(this.checked?"1":"0");l+=(l==""?s:","+s)});var p={data:l,id_user:$("#edit_user_id").val()};$.ajax({dataType:"json",type:o,url:m,data:p}).done(function(s){}).fail(function(s){return alert(s.error)})};var d=$("#user_form_add").dialog({title:"Добавление пользователя",autoOpen:false,resizable:false,modal:true,height:430,width:500,close:function(){$(this)[0].reset()},buttons:[{text:"Ok",click:function(){k(this);f.init($("#right"));h.init(f,"ajax/getuser_all/","","get");h.reqest();$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});var i=$("#user_form_edit").dialog({title:"Редактирование пользователя",autoOpen:false,resizable:false,modal:true,height:430,width:500,close:function(){$(this)[0].reset()},buttons:[{"class":"ui-button-left",text:"Привелегии...",click:function(){var l={id_user:$("#edit_user_id").val()};b.init($("#user_form_privelege"));h.init(b,"ajax/loadform_privelege/",l);h.reqest();$(this).dialog("close");a.dialog("open");a.focus()}},{text:"Ok",click:function(){k(this);f.init($("#right"));h.init(f,"ajax/getuser_all/","","get");h.reqest();$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});var a=$("#user_form_privelege").dialog({title:"Редактирование привелегий",autoOpen:false,resizable:false,modal:true,height:350,width:350,close:function(){$(this)[0].reset()},buttons:[{text:"Ok",click:function(){g(this);$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});$(document).tooltip();$(document).on("submit","#user_form_add",function(l){l.preventDefault();k(this);f.init($("#right"));h.init(f,"ajax/getuser_all/","","get");h.reqest();d.dialog("close")});$(document).on("submit","#user_form_edit",function(l){l.preventDefault();k(this);f.init($("#right"));h.init(f,"ajax/getuser_all/","","get");h.reqest();i.dialog("close")});$(document).on("submit","#user_form_privelege",function(l){l.preventDefault();g(this);a.dialog("close")});j.on("click","#add_user_btn",function(l){d.dialog("open");l.preventDefault()});j.on("click",".counter_str_even, .counter_str_odd",function(l){var m=$(this).attr("id");var n={id:m.slice(3)};c.init(e);h.init(c,"ajax/loadform_user/",n);h.reqest();i.dialog("open");l.preventDefault()});f.init(j);h.init(f,"ajax/getuser_all/","","get");h.reqest()});